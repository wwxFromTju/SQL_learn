# HTTP协议

### HTTP性能的考虑 
##### HTTP事务时延
* DNS查询：如果没有缓存，则DNS查询会很久（10＋S）
* 建立连接
* 请求，处理，响应
* 关闭

##### TCP时延主要部分
* 建立握手
* 慢启动拥塞控制
* 数据聚集的Nagle算法
* 捎带确认的TCP延迟确认算法
* TIME_WAIT时延和端口耗尽

##### TCP建立握手的时延
主要是三次握手的前2次，因为通常把相关请求放在第三次带给服务器，所以真正浪费时间的是前两次，第三次已经算是开始请求和数据传输了。

##### TCP延时确认
TCP通常不会把ACK相应数据分组当成一个单独的数据分组发给发送方的，而是希望在传送数据时候，同时把ACK带上，这样就少发数据分组了。所以在TCP中采用：如果要ACK，则缓存起来，等待有发送数据的时候带上ACK，如果过一段时间一直没有发送数据，才单独发送ACK。但是实际上发送和接收是不平等，通常接收方很少发给发送方，所以很多ACK都延时了这段时间，导致性能下降。

##### TCP慢启动
为了拥塞避免，TCP采用慢启动，从1开始，然后一直调整发送窗口。通常是过一段时间的TCP的发送窗口会比较稳定。如果都是从头开始，则前面这一段从1开始的时间实际上是效率低的。可以采用持久连接，这样窗口比较稳定，可以开始就发送很多数据了

##### Nagle算法与TCP_NODELAY
Nagle是为了协调报文的首部和数据的比例，把数据缓存到一定大小再发送。这样在一些场景中比较慢。可以设置TCP_NODELAY来关闭Nagle



